<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>ZValdivia 3D - Zonohedro Polar</title>
<link href="css/styles.css" rel="stylesheet"/>
<!-- jsPDF para generación de reportes PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>
<body class="dark-mode">
<!-- Pantalla de carga -->
<div class="loading-screen" id="loadingScreen">
<div class="loading-content">
<div class="loading-logo">
<svg class="logo-icon" viewBox="-10 -10 120 120" aria-hidden="true">
  <defs>
    <linearGradient id="logoGradient" x1="0%" x2="100%" y1="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1"></stop>
      <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1"></stop>
    </linearGradient>
  </defs>
  <g fill="none" stroke="url(#logoGradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0.95">
    <!-- Flor de la vida (6 círculos) -->
    <circle cx="50" cy="22" r="28"></circle>
    <circle cx="74" cy="36" r="28"></circle>
    <circle cx="74" cy="64" r="28"></circle>
    <circle cx="50" cy="78" r="28"></circle>
    <circle cx="26" cy="64" r="28"></circle>
    <circle cx="26" cy="36" r="28"></circle>
  </g>
</svg>
</div>
<h1 class="loading-title">ZVALDIVIA V2, 3D</h1>
<div class="loading-bar">
<div class="loading-progress"></div>
</div>
<p class="loading-text">El único límite es tu imaginación...</p>
</div>
</div>
<!-- Canvas 3D -->
<canvas id="c"></canvas>
<!-- Indicador flotante de altura interactivo -->
<div class="height-indicator" id="heightIndicator">
<div class="height-indicator-label">Altura Total</div>
<div class="height-indicator-input-wrapper">
<input class="height-indicator-input" id="heightIndicatorInput" min="0.1" placeholder="0.000" step="0.001" type="number"/>
<span class="height-indicator-unit">m</span>
</div>
<button class="height-indicator-button" id="heightIndicatorButton">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2.5" viewbox="0 0 24 24" width="16">
<polyline points="20 6 9 17 4 12"></polyline>
</svg>
</button>
<div class="height-indicator-hint">
      Click para editar la altura
    </div>
</div>
<!-- Branding discreto -->
<div class="app-branding">
<span class="brand-name">ZValdivia</span>
<span class="brand-version">3D</span>
</div>
<!-- Panel de control principal -->
<div class="main-controls" id="mainControls">
<div class="control-card">
<!-- Header con configuración básica -->
<div class="card-header">
<div class="header-info">
<div class="config-badge">
<span class="badge-label">N:</span>
<span class="badge-value" id="badgeN">11</span>
</div>
<div class="config-badge">
<span class="badge-label">α:</span>
<span class="badge-value" id="badgeAngle">39.8°</span>
</div>
<div class="config-badge">
<span class="badge-label">Ø:</span>
<span class="badge-value" id="badgeDiameter">10m</span>
</div>
<div class="config-badge" id="badgeLevels">
<span class="badge-label">Niveles:</span>
<span class="badge-value" id="badgeLevelsValue">-</span>
</div>
<div class="config-badge" id="badgeHeight">
<span class="badge-label">H:</span>
<span class="badge-value" id="badgeHeightValue">-</span>
</div>
</div>
<div class="header-actions">
<button class="theme-toggle" id="themeToggle" title="Cambiar tema">
<div class="toggle-track">
<div class="toggle-thumb">
<svg class="icon-sun" fill="none" height="12" stroke="currentColor" stroke-width="2.5" viewbox="0 0 24 24" width="12">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
<svg class="icon-moon" fill="none" height="12" stroke="currentColor" stroke-width="2.5" viewbox="0 0 24 24" width="12">
<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>
</div>
</div>
</button>
<button class="icon-button" id="toggleInfoBtn" title="Info">
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="16" y2="12"></line>
<line x1="12" x2="12.01" y1="8" y2="8"></line>
</svg>
</button>
<button class="icon-button" id="toggleMainPanelBtn" title="Colapsar panel">
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
</div>
</div>
<!-- Parámetros principales -->
<div class="params-section" id="paramsSection">
<div class="param-control">
<label class="param-label">N (Lados)</label>
<div class="param-inputs">
<input class="param-number" id="nNum" max="100" min="3" step="1" type="number" value="11"/>
<input class="param-slider" id="nRange" max="100" min="3" step="1" type="range" value="11"/>
</div>
</div>
<div class="param-control">
<label class="param-label">α (Ángulo)</label>
<div class="param-inputs">
<input class="param-number" id="aNum" max="89.9" min="0.1" step="0.01" type="number" value="39.8"/>
<input class="param-slider" id="aRange" max="89.9" min="0.1" step="0.01" type="range" value="39.8"/>
</div>
</div>
<div class="param-control" id="dmaxControl">
<label class="param-label">Dmax (ecuador, m)</label>
<div class="param-inputs">
<input class="param-number" id="dmaxNum" max="50" min="0.1" step="0.001" type="number" value="6.596"/>
<input class="param-slider" id="dmaxRange" max="50" min="0.1" step="0.001" type="range" value="6.596"/>
</div>
</div>
<div class="param-control" id="floorDiameterControl" style="display: none;">
<label class="param-label">Ø del piso (m)</label>
<div class="param-inputs">
<input class="param-number" id="floorDiameterNum" max="50" min="0.1" step="0.001" type="number" value="6"/>
<input class="param-slider" id="floorDiameterRange" max="50" min="0.1" step="0.001" type="range" value="6"/>
</div>
</div>
<div class="cut-section">
<div class="param-control">
<label class="param-label">Niveles visibles</label>
<div class="param-inputs">
<input class="param-number cut-input" id="cutLevelNum" max="10" min="1" type="number" value="5"/>
<input class="param-slider cut-slider" id="cutLevelRange" max="10" min="1" type="range" value="5"/>
</div>
</div>
<button class="action-button cut-button" id="cutBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
</svg>
<span>Crear porción</span>
</button>
</div>
</div>
<!-- Info rápida (colapsable en móvil) -->
<div class="quick-info" id="quickInfo">
<div class="info-grid">
<div class="info-item">
<span class="info-label">Altura Total</span>
<span class="info-value" id="infoH">0.00</span>
</div>
<div class="info-item">
<span class="info-label">h₁</span>
<span class="info-value" id="infoH1">0.000</span>
</div>
<div class="info-item">
<span class="info-label">Caras</span>
<span class="info-value" id="infoFaces">0</span>
</div>
<div class="info-item">
<span class="info-label" id="diameterLabel">Dmax</span>
<span class="info-value" id="infoDiameter">0.00</span>
</div>
<div class="info-item">
<span class="info-label">Lado rombo</span>
<span class="info-value" id="infoRhombusSide">0.000</span>
</div>
<div class="info-item" id="triangleBaseInfo" style="display: none;">
<span class="info-label">Base triángulo</span>
<span class="info-value" id="infoTriangleBase">0.000</span>
</div>
</div>
</div>
</div>
</div>
<!-- Botón flotante para opciones avanzadas -->
<button class="fab-button" id="toggleAdvancedBtn" title="Opciones avanzadas">
<svg class="fab-icon" fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
<circle cx="12" cy="12" r="3"></circle>
<path d="M12 1v6m0 6v6m-5-7l10 10m0-10L7 17"></path>
</svg>
<span class="fab-pulse"></span>
</button>
<!-- Panel de opciones avanzadas -->
<div class="advanced-panel" id="advancedPanel">
<div class="advanced-card">
<div class="advanced-header">
<h2 class="advanced-title">Opciones Avanzadas</h2>
<button class="icon-button close-button" id="closeAdvancedBtn">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="18" x2="6" y1="6" y2="18"></line>
<line x1="6" x2="18" y1="6" y2="18"></line>
</svg>
</button>
</div>
<div class="advanced-content">
<!-- Estructura para conectores -->
<div class="option-group" id="structureConnectorsGroup">
<button class="group-header" data-group="structure-connectors">
<svg class="group-icon" fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M12 2l9 5v10l-9 5-9-5V7l9-5z"></path>
<path d="M12 22V12"></path>
<path d="M21 7l-9 5-9-5"></path>
</svg>
<span class="group-title">Estructura para Conectores</span>
<svg class="group-chevron" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
<div class="group-content">
<div class="mini-form">
<div class="mini-form-row">
<label class="mini-label">Conector cilíndrico (mm)</label>
<div class="mini-input-grid">
<div class="mini-input-wrap">
<span class="mini-input-hint">Diámetro</span>
<input class="param-number" id="connCylDiameterMm" min="1" step="1" type="number" value="100"/>
</div>
<div class="mini-input-wrap">
<span class="mini-input-hint">Profundidad</span>
<input class="param-number" id="connCylDepthMm" min="1" step="1" type="number" value="50"/>
</div>
</div>
</div>
<div class="mini-form-row" style="margin-top: 10px;">
<label class="mini-label">Viga rectangular (mm)</label>
<div class="mini-input-grid">
<div class="mini-input-wrap">
<span class="mini-input-hint">Ancho</span>
<input class="param-number" id="beamWidthMm" min="1" step="1" type="number" value="40"/>
</div>
<div class="mini-input-wrap">
<span class="mini-input-hint">Alto</span>
<input class="param-number" id="beamHeightMm" min="1" step="1" type="number" value="90"/>
</div>
</div>
</div>
<button class="action-button primary" id="generateStructureBtn" style="margin-top: 12px;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M3 12h18"></path>
<path d="M12 3v18"></path>
</svg>
<span>Generar estructura para conectores</span>
</button>
<!-- Diagonales / aristas extra entre conectores -->
<div class="mini-form-row" style="margin-top: 12px;">
<label class="mini-label">Vigas extra (aristas/diagonales)</label>
<div style="display:flex; gap:10px; flex-wrap:wrap;">
<button class="action-button" id="toggleDiagonalModeBtn" title="Selecciona 2 conectores del mismo rombo para crear una viga extra (arista o diagonal)">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M4 4l16 16"></path>
<path d="M20 4L4 20"></path>
</svg>
<span>Vigas extra</span>
</button>
<button class="action-button" id="clearExtraBeamsBtn" title="Elimina todas las vigas extra creadas">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M3 6h18"></path>
<path d="M8 6V4h8v2"></path>
<path d="M19 6l-1 14H6L5 6"></path>
</svg>
<span>Limpiar</span>
</button>
<button class="action-button" id="multiSelectBeamsBtn" title="Selecciona múltiples vigas para eliminarlas juntas">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<rect height="7" rx="1" width="7" x="3" y="3"></rect>
<rect height="7" rx="1" width="7" x="14" y="3"></rect>
<rect height="7" rx="1" width="7" x="3" y="14"></rect>
<path d="M17 17l4 4M17 21l4-4"></path>
</svg>
<span id="multiSelectBeamsBtnLabel">Selección múltiple</span>
</button>
</div>
<div class="mini-help" style="margin-top:8px; font-size:12px; color:rgba(255,255,255,0.7); line-height:1.35;">
                  Activa el modo, toca 2 conectores dentro del mismo rombo, y elige diagonal horizontal o vertical. Puedes aplicar solo a ese rombo o a todo el nivel.
                </div>
</div>
<!-- Toggle + export OBJ -->
<div class="mini-form-row" style="margin-top: 12px; display:flex; align-items:center; justify-content:space-between; gap:10px;">
<label class="mini-label" style="margin:0;">Mostrar estructura</label>
<label style="display:flex; align-items:center; gap:8px; user-select:none;">
<input checked="" id="toggleStructureVisible" type="checkbox"/>
<span style="font-size:12px; color: rgba(255,255,255,0.75);">On/Off</span>
</label>
</div>


</div>
</div>
</div>
<!-- Visualización -->
<div class="option-group">
<button class="group-header" data-group="visualization">
<svg class="group-icon" fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
<circle cx="12" cy="12" r="3"></circle>
</svg>
<span class="group-title">Visualización</span>
<svg class="group-chevron" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
<div class="group-content">
<div class="button-grid">
<button class="option-button" id="facesBtn">
<span class="button-status">○</span>
<span>Caras</span>
</button>
<button class="option-button active" id="colorByLevelBtn">
<span class="button-status">●</span>
<span>Arcoíris</span>
</button>
<button class="option-button active" id="togglePolysBtn">
<span class="button-status">●</span>
<span>Polígonos</span>
</button>
<button class="option-button active" id="toggleLinesBtn">
<span class="button-status">●</span>
<span>Aristas</span>
</button>
<button class="option-button active" id="toggleAxisBtn">
<span class="button-status">●</span>
<span>Eje</span>
</button>
<button class="option-button" id="fitBtn">
<svg fill="none" height="14" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="14">
<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
</svg>
<span>Ajustar cámara</span>
</button>
</div>
</div>
</div>
<!-- Rotación -->
<div class="option-group">
<button class="group-header" data-group="rotation">
<svg class="group-icon" fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path>
</svg>
<span class="group-title">Rotación Automática</span>
<svg class="group-chevron" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
<div class="group-content">
<button class="action-button rotation-button" id="rotationBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polygon points="5 3 19 12 5 21 5 3"></polygon>
</svg>
<span>Iniciar rotación</span>
</button>
<div class="speed-control">
<label class="speed-label">Velocidad</label>
<input class="speed-slider" id="rotationSpeed" max="100" min="1" step="1" type="range" value="30"/>
</div>
</div>
</div>
<!-- Compartir -->
<div class="option-group">
<button class="group-header" data-group="share">
<svg class="group-icon" fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<circle cx="18" cy="5" r="3"></circle>
<circle cx="6" cy="12" r="3"></circle>
<circle cx="18" cy="19" r="3"></circle>
<line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line>
<line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line>
</svg>
<span class="group-title">Compartir</span>
<svg class="group-chevron" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
<div class="group-content">
<button class="action-button primary" id="shareUrlBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
<span>Copiar enlace</span>
</button>
</div>
</div>
<!-- Exportar -->
<div class="option-group">
<button class="group-header" data-group="export">
<svg class="group-icon" fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" x2="12" y1="15" y2="3"></line>
</svg>
<span class="group-title">Exportar</span>
<svg class="group-chevron" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="6 9 12 15 18 9"></polyline>
</svg>
</button>
<div class="group-content"><button class="action-button" id="exportPdfBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
</svg>
<span>PDF Caras (Rombos)</span>
</button><button class="action-button" id="exportBeamsPdfBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<path d="M14 2v6h6"></path>
<path d="M8 13h8"></path>
<path d="M8 17h8"></path>
</svg>
<span>PDF Vigas</span>
</button><button class="action-button" id="exportNodePdfBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M12 2v20"></path>
<path d="M4 10h16"></path>
<path d="M6 18h12"></path>
</svg>
<span>PDF Conectores</span>
</button><button class="action-button primary" id="exportStructureObjBtn" style="margin-top: 10px;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" x2="12" y1="15" y2="3"></line>
</svg>
<span>OBJ estructura total</span>
</button></div>
</div>
</div>
</div>
</div>
<script src="js/main.js" type="module"></script>
</body>
</html>
